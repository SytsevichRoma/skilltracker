{% extends "base.html" %}
{% block title %}{{ _("Week") }}{% endblock %}

{% block content %}
<style>
  .day-acc{
    border:1px solid var(--line);
    border-radius: 18px;
    background: rgba(255,255,255,.72);
    box-shadow: var(--shadow-sm);
    overflow:hidden;
    margin-bottom: 12px;
  }

  .day-acc summary{
    cursor:pointer;
    padding: 14px 14px;
    display:flex;
    align-items:center;
    justify-content: space-between;
    gap: 12px;
    list-style:none;
  }
  .day-acc summary::-webkit-details-marker { display:none; }

  .day-left{
    display:flex;
    align-items:center;
    gap: 10px;
  }
  .badge{
    display:inline-flex;
    align-items:center;
    justify-content:center;
    padding: 6px 10px;
    border-radius: 999px;
    background: rgba(0,0,0,.06);
    border: 1px solid rgba(0,0,0,.08);
    font-size: 12px;
    font-weight: 700;
    color: rgba(0,0,0,.72);
    white-space: nowrap;
  }
  .badge.today{
    background: rgba(10,132,255,.12);
    border-color: rgba(10,132,255,.20);
    color:#0a63c7;
  }

  .day-title{
    font-weight: 850;
    letter-spacing:-.3px;
    font-size: 15px;
  }
  .day-date{
    color: var(--muted);
    font-size: 12px;
    font-weight: 650;
  }

  .inside{
    padding: 0 14px 14px;
  }

  .task-row{
    display:flex;
    align-items:center;
    justify-content:space-between;
    gap: 10px;
    padding: 10px 10px;
    border-radius: 14px;
    border: 1px solid rgba(0,0,0,.07);
    background: rgba(255,255,255,.86);
    box-shadow: 0 10px 18px rgba(0,0,0,.05);
    margin-bottom: 10px;
  }
  .t-left{ display:flex; align-items:center; gap:10px; flex:1; min-width: 240px; }
  .dot{
    width: 14px; height: 14px; border-radius: 999px;
    border: 2px solid rgba(0,0,0,.18);
    flex: 0 0 auto;
  }
  .dot.must{ border-color: rgba(255,59,48,.45); background: rgba(255,59,48,.12); }
  .dot.goal{ border-color: rgba(10,132,255,.45); background: rgba(10,132,255,.12); }
  .dot.dream{ border-color: rgba(52,199,89,.45); background: rgba(52,199,89,.12); }

  .t-title{ font-weight: 750; letter-spacing:-.2px; overflow:hidden; text-overflow:ellipsis; white-space:nowrap; }
  .t-meta{ color: var(--muted); font-size: 12px; font-weight: 650; white-space: nowrap; }

  .form-card{
    border:1px solid var(--line);
    border-radius: 16px;
    background: rgba(255,255,255,.70);
    padding: 12px;
    margin-top: 12px;
  }
</style>

<div class="card pad">
  <div class="top">
    <div>
      <h1 class="h1">{{ _("Week") }}</h1>
      <div class="muted">{{ _("Plan tasks for 7 days") }}</div>
    </div>
  </div>

  {% if not goals %}
    <div class="flash">
      {{ _("No goals yet") }} ðŸ˜… â€” {{ _("Create goal") }}
    </div>
    <a class="btn btn-primary" href="{{ url_for('goals.create_goal') }}" style="text-decoration:none;">
      + {{ _("Create goal") }}
    </a>
  {% else %}

    {% for d in days %}
      {% set items = tasks_by_day.get(d, []) %}
      <details class="day-acc" {% if d==today %}open{% endif %}>
        <summary>
          <div class="day-left">
            <span class="badge {% if d==today %}today{% endif %}">
              {{ weekday_names[d.weekday()] }}
            </span>
            <div>
              <div class="day-title">
                {{ _("Day") }} {{ loop.index }}
                {% if d==today %} â€” {{ _("Today") }}{% endif %}
              </div>
              <div class="day-date">{{ d.strftime("%Y-%m-%d") }}</div>
            </div>
          </div>

          <span class="badge">{{ items|length }}</span>
        </summary>

        <div class="inside">
          {% if items %}
            {% for t in items %}
              <div class="task-row">
                <div class="t-left">
                  <span class="dot {{ t.task_type or '' }}"></span>
                  <div class="t-title">{{ t.title }}</div>
                </div>

                <div class="t-meta">
                  {% if t.task_type %}{{ t.task_type }}{% endif %}
                  {% if t.due_date %} â€¢ {{ _("Due") }}: {{ t.due_date.strftime("%Y-%m-%d") }}{% endif %}
                </div>
              </div>
            {% endfor %}
          {% else %}
            <div class="muted">{{ _("No tasks") }}</div>
          {% endif %}

          <div class="form-card">
            <form method="post" action="{{ url_for('tasks.create_task') }}">
              <input type="hidden" name="planned_for" value="{{ d.strftime('%Y-%m-%d') }}">

              <div class="row">
                <input class="input" name="title" placeholder="{{ _('Title') }}..." required>
              </div>

              <div style="height:10px;"></div>

              <div class="row">
                <select class="select" name="goal_id" required>
                  {% for g in goals %}
                    <option value="{{ g.id }}">{{ g.title }}</option>
                  {% endfor %}
                </select>

                <select class="select" name="task_type">
                  <option value="">{{ _("Type") }}â€¦</option>
                  {% for val, label in task_types %}
                    <option value="{{ val }}">{{ label }}</option>
                  {% endfor %}
                </select>

                <input class="input" type="date" name="due_date" placeholder="Due date">
              </div>

              <div style="margin-top:12px; display:flex; justify-content:flex-end;">
                <button class="btn btn-primary" type="submit">+ {{ _("Add") }}</button>
              </div>
            </form>
          </div>
        </div>
      </details>
    {% endfor %}

  {% endif %}
</div>
{% endblock %}
